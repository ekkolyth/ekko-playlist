services:
    ekko-playlist:
        image: ekkolyth/ekko-playlist:dev
        container_name: ekko-playlist
        restart: unless-stopped
        networks:
            - caddy
        env_file: .env
        environment:
            API_PORT: ${API_PORT:-1337}
            WEB_PORT: ${WEB_PORT:-3000}
            BETTER_AUTH_URL: ${BETTER_AUTH_URL}
            BETTER_AUTH_SECRET: ${BETTER_AUTH_SECRET}
            DB_URL: ${DB_URL}
            CORS_ALLOWED_ORIGINS: ${CORS_ALLOWED_ORIGINS}
        ports:
            - "${API_PORT:-1337}:1337"
            - "${WEB_PORT:-3000}:3000"
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:${API_PORT:-1337}/api/healthz"]
            interval: 30s
            timeout: 10s
            retries: 3
            start_period: 40s

networks:
    caddy:
        external: true
